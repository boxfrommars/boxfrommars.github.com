"use strict";angular.module("tollsApp",["ngAnimate","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","leaflet-directive"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainController",controllerAs:"MainCtrl"})}]),angular.module("tollsApp").controller("MainController",["$http","leafletData",function(a,b){var c="//rnd.fasten.com",d=new L.FeatureGroup,e=new L.FeatureGroup,f=this;f.tracks=[],f.markers=[],f.currentTrack=null;var g=[{code:"EN1",coordinates:[{lat:42.34789571323296,lng:-71.06101334095001},{lat:42.34717413897111,lng:-71.06161415576935},{lat:42.34694418499349,lng:-71.06207549571991},{lat:42.346904537670945,lng:-71.06280505657196},{lat:42.346920396602954,lng:-71.06350243091583}]}],h=[{code:"EX1",coordinates:[{lat:42.355293353966324,lng:-71.11847698688507},{lat:42.35553120577965,lng:-71.11850917339324},{lat:42.35618132947636,lng:-71.1187881231308},{lat:42.35668081018698,lng:-71.119185090065}]},{code:"EX2",coordinates:[{lat:42.35087707511597,lng:-71.11142814159393},{lat:42.3511902684889,lng:-71.11167222261429},{lat:42.35155896248497,lng:-71.1119082570076}]}],i=[{lat:42.346920396602954,lng:-71.06350243091583},{lat:42.34703140901506,lng:-71.06387257575989},{lat:42.34733272743112,lng:-71.0651171207428},{lat:42.34757060937097,lng:-71.06642067432404},{lat:42.34776884363319,lng:-71.06793344020844},{lat:42.34788778389048,lng:-71.06937110424042},{lat:42.34788778389048,lng:-71.07088387012482},{lat:42.34789571323296,lng:-71.07216060161589},{lat:42.34789571323296,lng:-71.07349097728729},{lat:42.34781641976309,lng:-71.08956277370453},{lat:42.34784813716305,lng:-71.0910540819168},{lat:42.347832278465084,lng:-71.09260976314545},{lat:42.347832278465084,lng:-71.09417617321013},{lat:42.34780056105714,lng:-71.09588205814362},{lat:42.34782434911458,lng:-71.09746992588043},{lat:42.347792631702646,lng:-71.09924018383026},{lat:42.34787192520248,lng:-71.10080659389496},{lat:42.348086017152475,lng:-71.10199749469757},{lat:42.348458693992754,lng:-71.10413253307343},{lat:42.348767934799874,lng:-71.10574185848236},{lat:42.34906924489222,lng:-71.10720098018646},{lat:42.349481561625495,lng:-71.1085957288742},{lat:42.35007624445802,lng:-71.10997974872589},{lat:42.35087707511597,lng:-71.11142814159393},{lat:42.35146381585433,lng:-71.11261904239655},{lat:42.351907832231745,lng:-71.11368119716644},{lat:42.35236770303022,lng:-71.11461460590363},{lat:42.35296235855687,lng:-71.115762591362},{lat:42.353588722960616,lng:-71.11693203449249},{lat:42.354326080651326,lng:-71.11786544322966},{lat:42.355293353966324,lng:-71.11847698688507},{lat:42.3558562684687,lng:-71.11879885196686},{lat:42.35644296272466,lng:-71.11932456493378},{lat:42.35690280033964,lng:-71.11988246440887},{lat:42.35724371226148,lng:-71.1204832792282},{lat:42.35742605973958,lng:-71.12112700939178},{lat:42.3575370535976,lng:-71.1218672990799}],j={track:{color:"red",weight:2,latlngs:[],message:"<h3>Route from London to Rome</h3><p>Distance: 1862km</p>"}};_.each(g,function(a){j[a.code]={color:"blue",weight:4,latlngs:a.coordinates,message:"<h3>"+a.code+"</h3>"}}),_.each(h,function(a){j[a.code]={color:"purple",weight:4,latlngs:a.coordinates,message:"<h3>"+a.code+"</h3>"},f.markers=f.markers.concat(_.map(a.coordinates,function(a){return _.extend({message:JSON.stringify(a)},a)}))}),j.toll={color:"green",weight:4,latlngs:i,message:"<h3>Toll</h3>"},f.markers=f.markers.concat(_.map(i,function(a){return _.extend({message:JSON.stringify(a),icon:{type:"awesomeMarker",icon:"dot",markerColor:"green"}},a)})),console.log(j),f.map={controls:{position:"topright",draw:{polyline:{},polygon:!1,rectangle:!1,circle:!1,marker:!1},edit:{featureGroup:d,remove:!1}},center:{lat:42.347638,lng:-71.058187,zoom:14},layers:{baselayers:{googleRoadmap:{name:"Google Streets",layerType:"ROADMAP",type:"google"}}},paths:j},b.getMap().then(function(a){a.addLayer(d),a.addLayer(e),a.on("draw:created",function(a){var b=a.layer;d.addLayer(b);var c=b.toGeoJSON().geometry.coordinates.map(function(a){return{lat:+a[1],lng:+a[0]}});f.markers=c,console.log(JSON.stringify(c))})}),f.trackSelected=function(){a.post(c+"/gettrack","track="+f.currentTrack.id,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a){f.map.paths.track.latlngs=[],_.each(a.coords,function(a,b){var c={lat:+a[0],lng:+a[1]};f.map.paths.track.latlngs.push(c)})})},a.get(c+"/list").success(function(a){f.tracks=_.map(a.tracks,function(a,b){return{name:a,id:b}}),f.currentTrack={id:61},f.trackSelected()})}]);