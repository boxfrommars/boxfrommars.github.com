"use strict";angular.module("fastenHuntersFrontendApp",["ngAnimate","ngCookies","ngResource","ngSanitize","mobile-angular-ui","mobile-angular-ui.gestures","ui.router","darthwade.loading"]).config(["$stateProvider",function(a){a.state("root",{url:"",templateUrl:"views/layout.html",controller:"LayoutController",controllerAs:"LayoutCtrl",resolve:{}}).state("error",{url:"/error",controller:"ErrorController",controllerAs:"ErrorCtrl",templateUrl:"views/general/error.html"})}]),angular.module("fastenHuntersFrontendApp").filter("moment",function(){return function(a,b){return moment(a).format(b)}}).filter("momentUTC",function(){return function(a,b){return moment(a).utc().format(b)}}).filter("momentTime",function(){return function(a){return moment(a).format("L LT")}}).filter("momentDate",function(){return function(a){return moment(a).format("L")}}),angular.module("fastenHuntersFrontendApp").constant("appConfig",{BASE_URL:"//95.213.131.42:8180/"}).factory("reqres",["$http","user","appConfig",function(a,b,c){var d=c.BASE_URL,e={post:function(b,c){return a.post(d+b,c).then(function(a){return a.data})},get:function(b){return a.get(d+b,{data:""}).then(function(a){return a.data})},put:function(b,c){return a.put(d+b,c).then(function(a){return a.data})},setToken:function(b){a.defaults.headers.common.api_token=b},removeToken:function(){delete a.defaults.headers.common.api_token}};return e.setToken(b.getToken()),a.defaults.headers.common["Content-Type"]="application/json",e}]),angular.module("fastenHuntersFrontendApp").factory("user",["$window","$log",function(a,b){var c=a.localStorage.token;b.debug("security: token "+(c?c:"is not set"));var d={getToken:function(){return c},isAuthentiicated:function(){return!!c},setToken:function(d){a.localStorage.token=c=d,b.debug("security: token "+(c?c:"is not set"))}};return window.SecurityAPI=d,d}]).factory("security",["$rootScope","user","userRepository","reqres",function(a,b,c,d){var e={login:function(a){return c.login(a).then(function(a){return b.setToken(a.token),d.setToken(a.token),{success:!0}},function(){return{success:!1}})},logout:function(){d.removeToken(),b.setToken("")},isAuthenticated:b.isAuthentiicated,getToken:b.getToken};return a.isAuthenticated=e.isAuthenticated,a.getToken=e.getToken,e}]).run(["$rootScope","$location","security","$log",function(a,b,c,d){var e=["/login"],f=function(a){var b=!0;return e.forEach(function(c){0===a.indexOf(c)&&(b=!1)}),b};a.$on("$stateChangeStart",function(e){f(b.url())&&!c.isAuthenticated()&&(d.debug("security: redirect to login"),e.preventDefault(),a.$evalAsync(function(){b.path("/login")}))})}]),angular.module("fastenHuntersFrontendApp").constant("CONTACT_RESOURCES",{SEARCH:"core-webapp/api/hunter/note/search",SAVE:"core-webapp/api/hunter/note/add"}).factory("contactRepository",["$q","reqres","CONTACT_RESOURCES",function(a,b,c){var d=["DO_NOT_BOTHER","HARD_REFUSAL","POLITE_REFUSAL","LOW_INTEREST","HIGH_INTEREST"],e={search:function(a){return b.post(c.SEARCH,{limit:15,page:1,search_string:a}).then(function(a){return a.notes})},find:function(a){return e.search(a).then(function(b){return _.findWhere(b,{lp_number:a})})},getResponseTypes:function(){return a.when(d)},save:function(a){return b.put(c.SAVE,a).then(function(a){return a})}};return e}]),angular.module("fastenHuntersFrontendApp").constant("USER_RESOURCES",{LOGIN:"core-webapp/api/hunter/login"}).factory("userRepository",["reqres","USER_RESOURCES",function(a,b){return{login:function(c){return a.post(b.LOGIN,{login:c.username,password:c.password})}}}]),angular.module("fastenHuntersFrontendApp").constant("CODE_RESOURCES",{GET_CODE:"core-webapp/api/hunter/code/new"}).factory("codeRepository",["reqres","CODE_RESOURCES",function(a,b){return{getCode:function(){return a.get(b.GET_CODE).then(function(a){return a.code})}}}]),angular.module("fastenHuntersFrontendApp").directive("contactRow",[function(){return{restrict:"AE",scope:{contact:"="},templateUrl:"views/contactRow.html"}}]),angular.module("fastenHuntersFrontendApp").controller("LayoutController",["$scope","$state","security","$loading",function(a,b,c,d){a.$state=b,b.is("root")&&b.go("root.contacts"),this.logout=function(){c.logout(),b.go("login")},d.setDefaultOptions({text:"",spinnerOptions:{color:"#444"}})}]),angular.module("fastenHuntersFrontendApp").config(["$stateProvider",function(a){a.state("login",{url:"/login",templateUrl:"views/login.html",controller:"LoginController",controllerAs:"LoginCtrl",resolve:{}})}]).controller("LoginController",["security","$state","$timeout",function(a,b,c){var d=this;d.credentials={},d.isInvalidCredentials=!1,d.waiting=!1,a.isAuthenticated()&&b.go("root.contacts");var e=function(){a.login(d.credentials).then(function(a){d.waiting=!1,d.isInvalidCredentials=!a.success,a.success&&b.go("root.contacts")})};d.login=function(a){a.$valid&&(d.isInvalidCredentials=!1,d.waiting=!0,c(e,1e3))}}]),angular.module("fastenHuntersFrontendApp").controller("CodeController",["codeRepository","$scope","$loading",function(a,b,c){var d=this;b.$on("mobile-angular-ui.state.changed.uiSidebarRight",function(a,b){b&&d.refreshCode()}),d.refreshCode=function(){c.start("code-section"),a.getCode().then(function(a){d.code=a,c.finish("code-section")})}}]),angular.module("fastenHuntersFrontendApp").config(["$stateProvider",function(a){a.state("root.contacts",{url:"/contacts",templateUrl:"views/contacts.html",controller:"ContactsController",controllerAs:"ContactsCtrl",resolve:{}}).state("root.contact",{url:"/contact/:id",templateUrl:"views/contact.html",controller:"ContactViewController",controllerAs:"ContactCtrl",resolve:{}})}]).controller("ContactsController",["$timeout","contactRepository","$state",function(a,b,c){var d=this;d.contacts=[],d.searchQuery="",d.contact={},b.getResponseTypes().then(function(a){d.responseTypes=a}),d.search=function(a){b.search(a).then(function(a){d.contacts=a})},d.clearSearch=function(){d.searchQuery=""},d.saveContact=function(a){a.$valid&&b.save(d.contact).then(function(){c.go("root.contact",{id:d.contact.lp_number})})}}]).controller("ContactViewController",["$stateParams","contactRepository",function(a,b){var c=this,d=a.id;b.find(d).then(function(a){c.contact=a,console.log(a)})}]);