"use strict";angular.module("fastenHuntersFrontendApp",["ngAnimate","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","mobile-angular-ui","mobile-angular-ui.gestures","ui.select","ui.router"]).config(["$stateProvider",function(a){a.state("root",{url:"",templateUrl:"views/layout.html",controller:"LayoutController",controllerAs:"LayoutCtrl",resolve:{}}).state("error",{url:"/error",controller:"ErrorController",controllerAs:"ErrorCtrl",templateUrl:"views/general/error.html"})}]),angular.module("fastenHuntersFrontendApp").filter("moment",function(){return function(a,b){return moment(a).format(b)}}).filter("momentUTC",function(){return function(a,b){return moment(a).utc().format(b)}}).filter("momentTime",function(){return function(a){return moment(a).format("L LT")}}).filter("momentDate",function(){return function(a){return moment(a).format("L")}}),angular.module("fastenHuntersFrontendApp").factory("contactRepository",["$q",function(a){var b=[{priority:0,name:"LOW INTEREST",id:1},{priority:1,name:"HIGH INTEREST",id:2},{priority:2,name:"POLITE REFUSAL",id:3},{priority:3,name:"HARD REFUSAL",id:4},{priority:3,name:"DO NOT BOTHER",id:5}],c=[{id:"1",lp:"LP90210",response_id:1,name:"Kirill E.",note:"There are many variations of passages of Lorem Ipsum available",response_count:1,response:{name:"LOW INTEREST",priority:0}},{id:"2",lp:"LP42424",response_id:2,name:"Dmitry G.",note:"Contrary to popular belief, Lorem Ipsum is not simply random text",response_count:2,response:{name:"HIGH INTEREST",priority:1}},{id:"3",lp:"LP12345",response_id:3,name:"Kirill E.",note:"College in Virginia, looked up one of the more obscure Latin words, consectetur",response_count:3,response:{name:"POLITE REFUSAL",priority:2}},{id:"4",lp:"LP23456",response_id:4,name:"Vera G.",note:"There are many variations of passages of Lorem Ipsum available",response_count:4,response:{name:"HARD REFUSAL",priority:3}},{id:"5",lp:"LP83559",response_id:1,name:"Kirill E.",note:"Contrary to popular belief, Lorem Ipsum is not simply random text",response_count:5,response:{name:"LOW INTEREST",priority:0}},{id:"6",lp:"LP22092",response_id:2,name:"Dmitry G.",note:"There are many variations of passages of Lorem Ipsum available",response_count:1,response:{name:"HIGH INTEREST",priority:1}},{id:"7",lp:"LP72227",response_id:3,name:"Vera G.",note:"Contrary to popular belief, Lorem Ipsum is not simply random text",response_count:2,response:{name:"POLITE REFUSAL",priority:2}},{id:"8",lp:"LP96199",response_id:4,name:"Vera G.",note:"College in Virginia, looked up one of the more obscure Latin words, consectetur",response_count:3,response:{name:"HARD REFUSAL",priority:3}},{id:"9",lp:"LP22453",response_id:5,name:"Vera G.",note:"College in Virginia, looked up one of the more obscure Latin words, consectetur",response_count:4,response:{name:"LOW INTEREST",priority:3}},{id:"10",lp:"LP41234",response_id:2,name:"Vera G.",note:"There are many variations of passages of Lorem Ipsum available",response_count:4,response:{name:"HIGH INTEREST",priority:1}}];return{list:function(){return a.when(c)},search:function(b){var d=_.filter(c,function(a){return 0===a.lp.toUpperCase().indexOf(b.toUpperCase())});return a.when(d)},find:function(b){return a.when(_.findWhere(c,{id:b}))},getResponseTypes:function(){return a.when(b)},save:function(b){var d=_.extend({},b,{response_count:1,response_id:b.response.id,name:"Evdakov K.",id:""+(_.max(_.pluck(c,"id"))+1)});return c.push(d),a.when(d)}}}]),angular.module("fastenHuntersFrontendApp").directive("contactRow",[function(){return{restrict:"AE",scope:{contact:"="},templateUrl:"views/contactRow.html"}}]),angular.module("fastenHuntersFrontendApp").controller("LayoutController",["$scope","$state","security",function(a,b,c){a.$state=b,b.is("root")&&console.log("root state"),this.logout=function(){c.logout(),b.go("login")}}]),angular.module("fastenHuntersFrontendApp").config(["$stateProvider",function(a){a.state("login",{url:"/login",templateUrl:"views/login.html",controller:"LoginController",controllerAs:"LoginCtrl",resolve:{}})}]).controller("LoginController",["security","$state","$timeout",function(a,b,c){var d=this;d.credentials={},d.isInvalidCredentials=!1,d.waiting=!1,a.isAuthenticated()&&b.go("root.contacts"),d.login=function(e){console.log("credentials",d.credentials,e),e.$valid&&(d.isInvalidCredentials=!1,d.waiting=!0,c(function(){a.login(d.credentials).then(function(a){d.waiting=!1,a.success?(d.isInvalidCredentials=!1,b.go("root.contacts")):d.isInvalidCredentials=!0})},1e3))}}]).factory("userRepository",["$q",function(a){return{login:function(b){return"test"===b.username&&"11111"===b.password?a.when({token:"11111",success:!0}):a.when({success:!1})}}}]).factory("user",["$window","$log",function(a,b){var c=a.localStorage.token;b.debug("security: token "+(c?c:"is not set"));var d={getToken:function(){return c},isAuthentiicated:function(){return!!c},setToken:function(d){a.localStorage.token=c=d,b.debug("security: token "+(c?c:"is not set"))}};return window.SecurityAPI=d,d}]).factory("security",["$rootScope","user","userRepository",function(a,b,c){var d={login:function(a){return c.login(a).then(function(a){return a.success&&b.setToken("11111"),{success:a.success}})},logout:function(){b.setToken("")},isAuthenticated:b.isAuthentiicated,getToken:b.getToken};return a.isAuthenticated=d.isAuthenticated,a.getToken=d.getToken,d}]).run(["$rootScope","$location","security","$log",function(a,b,c,d){var e=["/login"],f=function(a){var b=!0;return e.forEach(function(c){0===a.indexOf(c)&&(b=!1)}),b};a.$on("$stateChangeStart",function(e){f(b.url())&&!c.isAuthenticated()&&(d.debug("security: redirect to login"),e.preventDefault(),a.$evalAsync(function(){b.path("/login")}))})}]),angular.module("fastenHuntersFrontendApp").controller("CodeController",["codeRepository","$scope",function(a,b){var c=this;b.$on("mobile-angular-ui.state.changed.uiSidebarRight",function(a,b){b&&c.refreshCode()}),c.refreshCode=function(){a.getCode().then(function(a){c.code=a})}}]).factory("codeRepository",["$q",function(a){var b=["PENIS","VAGINA","NIPPLE","TESTICLE"];return{getCode:function(){var c=_.sample(b)+_.random(100,999);return a.when(c)}}}]),angular.module("fastenHuntersFrontendApp").config(["$stateProvider",function(a){a.state("root.contacts",{url:"/contacts",templateUrl:"views/contacts.html",controller:"ContactsController",controllerAs:"ContactsCtrl",resolve:{}}).state("root.contact",{url:"/contact/:id",templateUrl:"views/contact.html",controller:"ContactViewController",controllerAs:"ContactCtrl",resolve:{}})}]).controller("ContactsController",["$timeout","contactRepository","$state",function(a,b,c){var d=this;d.contacts=[],d.searchQuery="",d.contact={},b.getResponseTypes().then(function(a){d.responseTypes=a}),d.search=function(a){b.search(a).then(function(a){d.contacts=a})},d.clearSearch=function(){d.searchQuery=""},d.saveContact=function(a){a.$valid&&b.save(d.contact).then(function(a){console.log("created",a),c.go("root.contact",{id:a.id})})}}]).controller("ContactViewController",["$stateParams","contactRepository","$state",function(a,b,c){var d=this;console.log("root.contact",c.is("root.contact"));var e=a.id;b.find(e).then(function(a){console.log("contact",a),d.contact=a})}]);